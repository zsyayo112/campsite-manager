# 营地管理系统测试指南

## 概述

本文档提供营地管理系统的完整测试指南，包括功能测试、权限测试、性能测试等。

## 测试环境准备

### 1. 环境配置
- 确保开发服务器运行：`npm run dev`
- 数据库已初始化：`npx prisma db push && npx prisma db seed`
- 测试用户已创建（种子数据包含）

### 2. 测试用户账户
```
管理员账户：
Email: admin@campsite.com
Password: admin123

员工账户：
Email: staff@campsite.com  
Password: staff123

客户账户：
Email: customer@campsite.com
Password: customer123
```

## 功能测试清单

### 1. 用户认证系统测试

#### 1.1 登录功能
- [ ] 有效邮箱和密码登录成功
- [ ] 无效邮箱登录失败
- [ ] 错误密码登录失败
- [ ] 空邮箱或密码登录失败
- [ ] 登录后正确跳转到对应角色仪表盘

#### 1.2 注册功能
- [ ] 有效信息注册成功
- [ ] 重复邮箱注册失败
- [ ] 无效邮箱格式注册失败
- [ ] 密码太短注册失败
- [ ] 必填字段为空注册失败

#### 1.3 登出功能
- [ ] 登出后清除认证状态
- [ ] 登出后访问受保护页面重定向到登录页

### 2. 套餐管理系统测试

#### 2.1 套餐列表页面 (`/packages`)
- [ ] 正确显示所有激活状态套餐
- [ ] 搜索功能正常工作
- [ ] 价格过滤功能正常工作
- [ ] 容量过滤功能正常工作
- [ ] 分页功能正常工作
- [ ] 排序功能正常工作

#### 2.2 套餐详情页面 (`/packages/[id]`)
- [ ] 正确显示套餐详细信息
- [ ] 图片轮播功能正常
- [ ] 预订按钮功能正常
- [ ] 管理员可见编辑和删除按钮
- [ ] 客户不可见管理功能
- [ ] 预订统计信息正确显示（员工和管理员）

#### 2.3 套餐创建页面 (`/packages/add`) - 管理员权限
- [ ] 所有表单字段验证正常
- [ ] 图片上传/URL验证正常
- [ ] 设施选择器功能正常
- [ ] 价格格式化正确
- [ ] 保存后正确跳转

#### 2.4 套餐编辑页面 (`/packages/[id]/edit`) - 管理员权限
- [ ] 正确预填充现有数据
- [ ] 编辑历史记录显示正常
- [ ] 保存修改功能正常
- [ ] 取消编辑功能正常

### 3. 预订管理系统测试

#### 3.1 预订列表页面 (`/bookings`)
- [ ] 客户只能看到自己的预订
- [ ] 员工和管理员可以看到所有预订
- [ ] 状态筛选功能正常
- [ ] 日期范围筛选功能正常
- [ ] 搜索功能正常
- [ ] 分页功能正常

#### 3.2 新建预订页面 (`/bookings/new`)
- [ ] 套餐选择器功能正常
- [ ] URL参数预选套餐功能正常
- [ ] 日期选择器验证正常
- [ ] 最小日期限制正常（今天以后）
- [ ] 退房日期必须晚于入住日期
- [ ] 客人数量验证正常
- [ ] 可用性检查功能正常
- [ ] 价格计算准确
- [ ] 预订创建成功

#### 3.3 预订详情页面 (`/bookings/[id]`)
- [ ] 正确显示预订详细信息
- [ ] 状态更新功能正常（员工和管理员）
- [ ] 客人信息显示正常
- [ ] 套餐信息显示正常
- [ ] 价格信息准确

#### 3.4 可用性检查
- [ ] 日期冲突正确检测
- [ ] 容量超限正确检测
- [ ] 套餐不存在处理正常
- [ ] 价格计算准确

### 4. 客户管理系统测试

#### 4.1 客户列表页面 (`/guests`) - 员工和管理员权限
- [ ] 正确显示所有客户信息
- [ ] 搜索功能正常（姓名、电话）
- [ ] 分页功能正常
- [ ] 批量操作功能正常
- [ ] 导出功能正常

#### 4.2 客户详情页面 (`/guests/[id]`) - 员工和管理员权限
- [ ] 正确显示客户详细信息
- [ ] 预订历史显示正常
- [ ] 编辑功能正常
- [ ] 保存修改功能正常

### 5. 仪表盘测试

#### 5.1 管理员仪表盘
- [ ] 业务统计数据准确
- [ ] 收入数据计算正确
- [ ] 今日概览数据准确
- [ ] 快速操作按钮功能正常

#### 5.2 员工仪表盘
- [ ] 今日任务显示正确
- [ ] 待处理预订列表准确
- [ ] 快速操作功能正常
- [ ] 统计数据准确

#### 5.3 客户仪表盘
- [ ] 个人预订统计准确
- [ ] 最近预订显示正确
- [ ] 快速操作功能正常
- [ ] 账户信息显示准确

## 权限测试清单

### 1. 访问控制测试
- [ ] 未登录用户访问受保护页面重定向到登录页
- [ ] 客户无法访问管理员页面
- [ ] 客户无法访问员工页面
- [ ] 员工无法访问管理员专有功能
- [ ] API权限控制正确

### 2. 数据隔离测试
- [ ] 客户只能查看自己的预订
- [ ] 客户无法查看其他客户的预订
- [ ] 客户无法修改其他客户的信息
- [ ] API级别数据过滤正确

### 3. 操作权限测试
- [ ] 只有管理员可以创建套餐
- [ ] 只有管理员可以编辑套餐
- [ ] 只有管理员可以删除套餐
- [ ] 员工和管理员可以更新预订状态
- [ ] 员工和管理员可以查看客户信息

## API 测试清单

### 1. 认证API测试
- [ ] `/api/auth/login` - 登录功能
- [ ] `/api/auth/register` - 注册功能
- [ ] `/api/auth/logout` - 登出功能
- [ ] `/api/auth/me` - 获取当前用户信息

### 2. 套餐API测试
- [ ] `GET /api/packages` - 获取套餐列表
- [ ] `POST /api/packages` - 创建套餐
- [ ] `GET /api/packages/[id]` - 获取套餐详情
- [ ] `PUT /api/packages/[id]` - 更新套餐
- [ ] `DELETE /api/packages/[id]` - 删除套餐

### 3. 预订API测试
- [ ] `GET /api/bookings` - 获取预订列表
- [ ] `POST /api/bookings` - 创建预订
- [ ] `GET /api/bookings/[id]` - 获取预订详情
- [ ] `PUT /api/bookings/[id]` - 更新预订状态
- [ ] `POST /api/bookings/availability` - 检查可用性

### 4. 客户API测试
- [ ] `GET /api/guests` - 获取客户列表
- [ ] `GET /api/guests/[id]` - 获取客户详情
- [ ] `PUT /api/guests/[id]` - 更新客户信息
- [ ] `GET /api/guests/export` - 导出客户数据

### 5. 用户API测试
- [ ] `GET /api/users` - 获取用户列表

## 错误处理测试

### 1. 输入验证测试
- [ ] 无效邮箱格式处理
- [ ] 过长或过短的字符串处理
- [ ] 负数或无效数字处理
- [ ] 无效日期格式处理
- [ ] 必填字段为空处理

### 2. 业务逻辑错误测试
- [ ] 预订日期冲突处理
- [ ] 容量超限处理
- [ ] 不存在的资源访问处理
- [ ] 权限不足处理

### 3. 网络错误测试
- [ ] 网络连接失败处理
- [ ] 服务器错误处理
- [ ] 超时处理

## 性能测试

### 1. 页面加载性能
- [ ] 首页加载时间 < 2秒
- [ ] 套餐列表页加载时间 < 3秒
- [ ] 预订列表页加载时间 < 3秒
- [ ] 图片加载优化

### 2. API响应性能
- [ ] 套餐列表API响应时间 < 500ms
- [ ] 预订创建API响应时间 < 1秒
- [ ] 可用性检查API响应时间 < 800ms

### 3. 并发测试
- [ ] 10个并发用户正常使用
- [ ] 同时创建多个预订处理正确
- [ ] 数据库连接池正常工作

## 浏览器兼容性测试

### 1. 桌面浏览器
- [ ] Chrome (最新版本)
- [ ] Firefox (最新版本)
- [ ] Safari (最新版本)
- [ ] Edge (最新版本)

### 2. 移动端浏览器
- [ ] iOS Safari
- [ ] Android Chrome
- [ ] 响应式设计正常

## 自动化测试

### 运行自动化测试
```bash
# Windows
.\scripts\test-system.bat

# Linux/Mac
./scripts/test-system.sh
```

### 测试覆盖范围
- [ ] 单元测试覆盖率 > 70%
- [ ] 集成测试覆盖核心功能
- [ ] E2E测试覆盖关键用户流程

## 问题报告模板

### Bug报告格式
```
标题: [功能模块] 简短描述问题

环境:
- 浏览器: Chrome 91.0
- 操作系统: Windows 10
- 用户角色: 管理员

重现步骤:
1. 步骤1
2. 步骤2
3. 步骤3

预期结果:
描述预期应该发生什么

实际结果:
描述实际发生了什么

截图:
(如果适用)

其他信息:
任何额外的相关信息
```

## 发布前检查清单

- [ ] 所有核心功能测试通过
- [ ] 权限控制测试通过
- [ ] API测试通过
- [ ] 错误处理测试通过
- [ ] 性能测试通过
- [ ] 浏览器兼容性测试通过
- [ ] 数据备份和恢复流程验证
- [ ] 安全性检查完成
- [ ] 文档更新完成